<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.blog.mapper.BlogMapper">

	<!-- 列出所有博客和对应的类型名称 -->
	<select id="listBlogAndTypeName"
		resultType="com.blog.dto.BlogTypeTagDTO">
		select b.*,t.name typeName from blog b inner join type t on b.type_id = t.id order by update_time desc
	</select>

	<!-- 通过id查找博客 -->
	<select id="findById" parameterType="long" resultType="blog">
		select * from blog where id = #{id}
	</select>

	<!-- 搜索博客 -->
	<select id="listBySearch" parameterType="com.blog.dto.BlogQueryDTO" resultType="com.blog.dto.BlogTypeTagDTO">
		select b.title,b.is_recommend,b.is_published,b.update_time,t.name typeName from blog b inner join type t on b.type_id = t.id
		<where>
			<if test="title != '' and title != null">
				and b.title like concat('%',#{title},'%')
			</if>
			<if test="typeId != '' and typeId != null">
				and b.type_id = #{typeId}
			</if>
			<if test="recommend == true">
				and b.is_recommend = #{isRecommend}
			</if>
		</where>
	</select>

	<!-- 插入博客数据 -->
	<insert id="save" parameterType="com.blog.dto.BlogTypeTagDTO"
		useGeneratedKeys="true" keyProperty="id">
		insert into blog
		(title,content,first_picture,flag,original_link,view_count,comment_count,like_count,down_count,is_appreciated,is_shared,is_commented,is_deleted,is_recommend,is_top,is_privated,is_published,create_time,update_time,type_id,user_id)
		values
		(#{title},#{content},#{firstPicture},#{flag},#{originalLink},#{viewCount},#{commentCount},#{likeCount},#{downCount},#{isAppreciated},#{isShared},#{isCommented},#{isDeleted},#{isRecommend},#{isTop},#{isPrivated},#{isPublished},#{createTime},#{updateTime},#{typeId},#{userId})
	</insert>

	<!-- 通过id更新博客 -->
	<update id="update" parameterType="blog">
		update blog set
		title=#{title},content=#{content},first_picture=#{firstPicture},flag=#{flag},is_appreciated=#{isAppreciated},is_shared=#{isShared},is_commented=#{isCommented},is_recommend=#{isRecommend},is_published=#{isPublished},update_time=#{updateTime},type_id=#{typeId}
		where id =#{id}
	</update>

</mapper>